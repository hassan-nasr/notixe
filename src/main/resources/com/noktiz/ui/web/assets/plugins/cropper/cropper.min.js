(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}})(function(z){var H=z(window),q=z(document),m=window.location,t=true,J=false,v=null,L=NaN,j=Infinity,s="undefined",i="directive",e=".cropper",P=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,l=/^(x|y|width|height)$/,A=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,M="cropper-modal",D="cropper-hidden",F="cropper-invisible",c="cropper-move",E="cropper-crop",C="cropper-disabled",k="mousedown touchstart",o="mousemove touchmove",I="mouseup mouseleave touchend touchleave touchcancel",d="wheel mousewheel DOMMouseScroll",a="resize"+e,f="dblclick",y="build"+e,n="built"+e,x="dragstart"+e,w="dragmove"+e,g="dragend"+e,O=function(Q){return typeof Q==="number"},r=function(R,Q){this.element=R;this.$element=z(R);this.defaults=z.extend({},r.DEFAULTS,z.isPlainObject(Q)?Q:{});this.$original=v;this.ready=J;this.built=J;this.cropped=J;this.rotated=J;this.disabled=J;this.replaced=J;this.init()},G=Math.round,B=Math.sqrt,N=Math.min,p=Math.max,u=Math.abs,h=Math.sin,b=Math.cos,K=parseFloat;r.prototype={constructor:r,support:{canvas:z.isFunction(z("<canvas>")[0].getContext)},init:function(){var Q=this.defaults;z.each(Q,function(R,S){switch(R){case"aspectRatio":Q[R]=u(K(S))||L;break;case"autoCropArea":Q[R]=u(K(S))||0.8;break;case"minWidth":case"minHeight":Q[R]=u(K(S))||0;break;case"maxWidth":case"maxHeight":Q[R]=u(K(S))||j;break}});this.image={rotate:0};this.load()},load:function(){var V=this,U=this.$element,R=this.element,T=this.image,S,Q;if(U.is("img")){Q=U.prop("src")}else{if(U.is("canvas")&&this.support.canvas){Q=R.toDataURL()}}if(!Q){return}if(this.replaced){this.replaced=J;T.rotate=0}this.$clone=(S=z("<img"+((typeof U.attr("crossOrigin")!==s||this.isCrossOriginURL(Q))?" crossOrigin":"")+' src="'+Q+'">'));S.one("load",function(){T.naturalWidth=this.naturalWidth||S.width();T.naturalHeight=this.naturalHeight||S.height();T.aspectRatio=T.naturalWidth/T.naturalHeight;V.url=Q;V.ready=t;V.build()});S.addClass(F).prependTo("body")},isCrossOriginURL:function(Q){var R=Q.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);if((R&&(R[1]!==m.protocol||R[2]!==m.hostname||R[3]!==m.port))){return t}return J},build:function(){var T=this.$element,S=this.defaults,R,Q;if(!this.ready){return}if(this.built){this.unbuild()}T.one(y,S.build);R=z.Event(y);T.trigger(R);if(R.isDefaultPrevented()){return}this.$cropper=(Q=z(r.TEMPLATE));T.addClass(D);this.$clone.removeClass(F).prependTo(Q);if(!this.rotated){this.$original=this.$clone.clone();this.$original.addClass(F).prependTo(this.$cropper);this.originalImage=z.extend({},this.image)}this.$container=T.parent();this.$container.append(Q);this.$canvas=Q.find(".cropper-canvas");this.$dragger=Q.find(".cropper-dragger");this.$viewer=Q.find(".cropper-viewer");S.autoCrop?(this.cropped=t):this.$dragger.addClass(D);S.dragCrop&&this.setDragMode("crop");S.modal&&this.$canvas.addClass(M);!S.dashed&&this.$dragger.find(".cropper-dashed").addClass(D);!S.movable&&this.$dragger.find(".cropper-face").data(i,"move");!S.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(D);this.$scope=S.multiple?this.$cropper:q;this.addListeners();this.initPreview();this.built=t;this.update();T.one(n,S.built);T.trigger(n)},unbuild:function(){if(!this.built){return}this.built=J;this.removeListeners();this.$preview.empty();this.$preview=v;this.$dragger=v;this.$canvas=v;this.$container=v;this.$cropper.remove();this.$cropper=v},update:function(Q){this.initContainer();this.initCropper();this.initImage();this.initDragger();if(Q){this.setData(Q,t);this.setDragMode("crop")}else{this.setData(this.defaults.data)}},resize:function(){clearTimeout(this.resizing);this.resizing=setTimeout(z.proxy(this.update,this,this.getData()),200)},preview:function(){var V=this.image,U=this.dragger,R=V.width,Q=V.height,T=U.left-V.left,S=U.top-V.top;this.$viewer.find("img").css({width:G(R),height:G(Q),marginLeft:-G(T),marginTop:-G(S)});this.$preview.each(function(){var X=z(this),W=X.width()/U.width;X.find("img").css({width:G(R*W),height:G(Q*W),marginLeft:-G(T*W),marginTop:-G(S*W)})})},addListeners:function(){var Q=this.defaults;this.$element.on(x,Q.dragstart).on(w,Q.dragmove).on(g,Q.dragend);this.$cropper.on(k,(this._dragstart=z.proxy(this.dragstart,this))).on(f,(this._dblclick=z.proxy(this.dblclick,this)));Q.zoomable&&this.$cropper.on(d,(this._wheel=z.proxy(this.wheel,this)));this.$scope.on(o,(this._dragmove=z.proxy(this.dragmove,this))).on(I,(this._dragend=z.proxy(this.dragend,this)));H.on(a,(this._resize=z.proxy(this.resize,this)))},removeListeners:function(){var Q=this.defaults;this.$element.off(x,Q.dragstart).off(w,Q.dragmove).off(g,Q.dragend);this.$cropper.off(k,this._dragstart).off(f,this._dblclick);Q.zoomable&&this.$cropper.off(d,this._wheel);this.$scope.off(o,this._dragmove).off(I,this._dragend);H.off(a,this._resize)},initPreview:function(){var Q='<img src="'+this.url+'">';this.$preview=z(this.defaults.preview);this.$viewer.html(Q);this.$preview.html(Q).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var Q=this.$container;this.container={width:p(Q.width(),300),height:p(Q.height(),150)}},initCropper:function(){var Q=this.container,S=this.image,R;if(((S.naturalWidth*Q.height/S.naturalHeight)-Q.width)>=0){R={width:Q.width,height:Q.width/S.aspectRatio,left:0};R.top=(Q.height-R.height)/2}else{R={width:Q.height*S.aspectRatio,height:Q.height,top:0};R.left=(Q.width-R.width)/2}this.$cropper.css({width:G(R.width),height:G(R.height),left:G(R.left),top:G(R.top)});this.cropper=R},initImage:function(){var S=this.image,R=this.cropper,Q={_width:R.width,_height:R.height,width:R.width,height:R.height,left:0,top:0,ratio:R.width/S.naturalWidth};this.defaultImage=z.extend({},S,Q);if(S._width!==R.width||S._height!==R.height){z.extend(S,Q)}else{S=z.extend(Q,S)}this.image=S;this.renderImage()},renderImage:function(R){var Q=this.image;if(R==="zoom"){Q.left-=(Q.width-Q.oldWidth)/2;Q.top-=(Q.height-Q.oldHeight)/2}Q.left=N(p(Q.left,Q._width-Q.width),0);Q.top=N(p(Q.top,Q._height-Q.height),0);this.$clone.css({width:G(Q.width),height:G(Q.height),marginLeft:G(Q.left),marginTop:G(Q.top)});if(R){this.defaults.done(this.getData());this.preview()}},initDragger:function(){var U=this.defaults,R=this.cropper,S=U.aspectRatio||this.image.aspectRatio,Q=this.image.ratio,T;if(((R.height*S)-R.width)>=0){T={height:R.width/S,width:R.width,left:0,top:(R.height-(R.width/S))/2,maxWidth:R.width,maxHeight:R.width/S}}else{T={height:R.height,width:R.height*S,left:(R.width-(R.height*S))/2,top:0,maxWidth:R.height*S,maxHeight:R.height}}T.minWidth=0;T.minHeight=0;if(U.aspectRatio){if(isFinite(U.maxWidth)){T.maxWidth=N(T.maxWidth,U.maxWidth*Q);T.maxHeight=T.maxWidth/S}else{if(isFinite(U.maxHeight)){T.maxHeight=N(T.maxHeight,U.maxHeight*Q);T.maxWidth=T.maxHeight*S}}if(U.minWidth>0){T.minWidth=p(0,U.minWidth*Q);T.minHeight=T.minWidth/S}else{if(U.minHeight>0){T.minHeight=p(0,U.minHeight*Q);T.minWidth=T.minHeight*S}}}else{T.maxWidth=N(T.maxWidth,U.maxWidth*Q);T.maxHeight=N(T.maxHeight,U.maxHeight*Q);T.minWidth=p(0,U.minWidth*Q);T.minHeight=p(0,U.minHeight*Q)}T.minWidth=N(T.maxWidth,T.minWidth);T.minHeight=N(T.maxHeight,T.minHeight);T.height*=U.autoCropArea;T.width*=U.autoCropArea;T.left=(R.width-T.width)/2;T.top=(R.height-T.height)/2;T.oldLeft=T.left;T.oldTop=T.top;this.defaultDragger=T;this.dragger=z.extend({},T)},renderDragger:function(){var R=this.dragger,Q=this.cropper;if(R.width>R.maxWidth){R.width=R.maxWidth;R.left=R.oldLeft}else{if(R.width<R.minWidth){R.width=R.minWidth;R.left=R.oldLeft}}if(R.height>R.maxHeight){R.height=R.maxHeight;R.top=R.oldTop}else{if(R.height<R.minHeight){R.height=R.minHeight;R.top=R.oldTop}}R.left=N(p(R.left,0),Q.width-R.width);R.top=N(p(R.top,0),Q.height-R.height);R.oldLeft=R.left;R.oldTop=R.top;this.dragger=R;if(!this.disabled){this.defaults.done(this.getData())}this.$dragger.css({width:G(R.width),height:G(R.height),left:G(R.left),top:G(R.top)});this.preview()},reset:function(Q){if(!this.cropped){return}if(Q){this.defaults.data={}}this.image=z.extend({},this.defaultImage);this.renderImage();this.dragger=z.extend({},this.defaultDragger);this.setData(this.defaults.data)},clear:function(){if(!this.cropped){return}this.cropped=J;this.setData({x:0,y:0,width:0,height:0});this.$canvas.removeClass(M);this.$dragger.addClass(D)},destroy:function(){var Q=this.$element;if(!this.ready){return}this.unbuild();Q.removeClass(D).removeData("cropper");if(this.rotated){Q.attr("src",this.$original.attr("src"))}},replace:function(R,Q){var V=this,U=this.$element,T=this.element,S;if(R&&R!==this.url&&R!==U.attr("src")){if(!Q){this.rotated=J;this.replaced=t}if(U.is("img")){U.attr("src",R);this.load()}else{if(U.is("canvas")&&this.support.canvas){S=T.getContext("2d");z('<img src="'+R+'">').one("load",function(){T.width=this.width;T.height=this.height;S.clearRect(0,0,T.width,T.height);S.drawImage(this,0,0);V.load()})}}}},setData:function(T,R){var Q=this.cropper,V=this.dragger,U=this.image,S=this.defaults.aspectRatio;if(!this.built||typeof T===s){return}if(T===v||z.isEmptyObject(T)){V=z.extend({},this.defaultDragger)}if(z.isPlainObject(T)&&!z.isEmptyObject(T)){if(!R){this.defaults.data=T}T=this.transformData(T);if(O(T.x)&&T.x<=Q.width-U.left){V.left=T.x+U.left}if(O(T.y)&&T.y<=Q.height-U.top){V.top=T.y+U.top}if(S){if(O(T.width)&&T.width<=V.maxWidth&&T.width>=V.minWidth){V.width=T.width;V.height=V.width/S}else{if(O(T.height)&&T.height<=V.maxHeight&&T.height>=V.minHeight){V.height=T.height;V.width=V.height*S}}}else{if(O(T.width)&&T.width<=V.maxWidth&&T.width>=V.minWidth){V.width=T.width}if(O(T.height)&&T.height<=V.maxHeight&&T.height>=V.minHeight){V.height=T.height}}}this.dragger=V;this.renderDragger()},getData:function(){var S=this.dragger,R=this.image,Q={};if(this.built){Q={x:S.left-R.left,y:S.top-R.top,width:S.width,height:S.height};Q=this.transformData(Q,t)}return Q},transformData:function(T,R){var S=this.image.ratio,Q={};z.each(T,function(U,V){V=K(V);if(l.test(U)&&!isNaN(V)){Q[U]=R?G(V/S):V*S}});return Q},setAspectRatio:function(Q){var R=Q==="auto";Q=K(Q);if(R||(!isNaN(Q)&&Q>0)){this.defaults.aspectRatio=R?L:Q;if(this.built){this.initDragger();this.renderDragger()}}},getImageData:function(){var Q={};if(this.ready){z.each(this.image,function(R,S){if(A.test(R)){Q[R]=S}})}return Q},getDataURL:function(R,T,W){var Q=z("<canvas>")[0],U=this.getData(),V="",S;if(!z.isPlainObject(R)){W=T;T=R;R={}}R=z.extend({width:U.width,height:U.height},R);if(this.cropped&&this.support.canvas){Q.width=R.width;Q.height=R.height;S=Q.getContext("2d");if(T==="image/jpeg"){S.fillStyle="#fff";S.fillRect(0,0,R.width,R.height)}S.drawImage(this.$clone[0],U.x,U.y,U.width,U.height,0,0,R.width,R.height);V=Q.toDataURL(T,W)}return V},setDragMode:function(U){var R=this.$canvas,T=this.defaults,Q=J,S=J;if(!this.built||this.disabled){return}switch(U){case"crop":if(T.dragCrop){Q=t;R.data(i,U)}break;case"move":S=t;R.data(i,U);break;default:R.removeData(i)}R.toggleClass(E,Q).toggleClass(c,S)},enable:function(){if(this.built){this.disabled=J;this.$cropper.removeClass(C)}},disable:function(){if(this.built){this.disabled=t;this.$cropper.addClass(C)}},rotate:function(R){var Q=this.image;R=K(R)||0;if(!this.built||R===0||this.disabled||!this.defaults.rotatable||!this.support.canvas){return}this.rotated=t;R=(Q.rotate=(Q.rotate+R)%360);this.replace(this.getRotatedDataURL(R),true)},getRotatedDataURL:function(W){var U=z("<canvas>")[0],S=U.getContext("2d"),T=W*Math.PI/180,R=u(W)%180,Z=R>90?(180-R):R,V=Z*Math.PI/180,X=this.originalImage,Y=X.naturalWidth,aa=X.naturalHeight,Q=u(Y*b(V)+aa*h(V)),ab=u(Y*h(V)+aa*b(V));U.width=Q;U.height=ab;S.save();S.translate(Q/2,ab/2);S.rotate(T);S.drawImage(this.$original[0],-Y/2,-aa/2,Y,aa);S.restore();return U.toDataURL()},zoom:function(U){var T=this.image,S,Q,R;U=K(U);if(!this.built||!U||this.disabled||!this.defaults.zoomable){return}S=T.width*(1+U);Q=T.height*(1+U);R=S/T._width;if(R>10){return}if(R<1){S=T._width;Q=T._height}if(R<=1){this.setDragMode("crop")}else{this.setDragMode("move")}T.oldWidth=T.width;T.oldHeight=T.height;T.width=S;T.height=Q;T.ratio=T.width/T.naturalWidth;this.renderImage("zoom")},dblclick:function(){if(this.disabled){return}if(this.$canvas.hasClass(E)){this.setDragMode("move")}else{this.setDragMode("crop")}},wheel:function(S){var T=S.originalEvent,R=117.25,W=5,Q=166.66665649414062,U=0.1,V;if(this.disabled){return}S.preventDefault();if(T.deltaY){V=T.deltaY;V=V%W===0?V/W:V%R===0?V/R:V/Q}else{V=T.wheelDelta?-T.wheelDelta/120:(T.detail?T.detail/3:0)}this.zoom(V*U)},dragstart:function(S){var U=S.originalEvent.touches,T=S,V,R,Q;if(this.disabled){return}if(U){Q=U.length;if(Q>1){if(this.defaults.zoomable&&Q===2){T=U[1];this.startX2=T.pageX;this.startY2=T.pageY;V="zoom"}else{return}}T=U[0]}V=V||z(T.target).data(i);if(P.test(V)){S.preventDefault();R=z.Event(x);this.$element.trigger(R);if(R.isDefaultPrevented()){return}this.directive=V;this.cropping=J;this.startX=T.pageX;this.startY=T.pageY;if(V==="crop"){this.cropping=t;this.$canvas.addClass(M)}}},dragmove:function(R){var U=R.originalEvent.touches,T=R,S,Q;if(this.disabled){return}if(U){Q=U.length;if(Q>1){if(this.defaults.zoomable&&Q===2){T=U[1];this.endX2=T.pageX;this.endY2=T.pageY}else{return}}T=U[0]}if(this.directive){R.preventDefault();S=z.Event(w);this.$element.trigger(S);if(S.isDefaultPrevented()){return}this.endX=T.pageX;this.endY=T.pageY;this.dragging()}},dragend:function(Q){var R;if(this.disabled){return}if(this.directive){Q.preventDefault();R=z.Event(g);this.$element.trigger(R);if(R.isDefaultPrevented()){return}if(this.cropping){this.cropping=J;this.$canvas.toggleClass(M,this.cropped&&this.defaults.modal)}this.directive=""}},dragging:function(){var ab=this.directive,W=this.image,R=this.cropper,ad=R.width,ae=R.height,T=this.dragger,U=T.width,ag=T.height,V=T.left,aa=T.top,ac=V+U,Q=aa+ag,S=t,X=this.defaults,af=X.aspectRatio,Z={x:this.endX-this.startX,y:this.endY-this.startY},Y;if(af){Z.X=Z.y*af;Z.Y=Z.x/af}switch(ab){case"all":V+=Z.x;aa+=Z.y;break;case"e":if(Z.x>=0&&(ac>=ad||af&&(aa<=0||Q>=ae))){S=J;break}U+=Z.x;if(af){ag=U/af;aa-=Z.Y/2}if(U<0){ab="w";U=0}break;case"n":if(Z.y<=0&&(aa<=0||af&&(V<=0||ac>=ad))){S=J;break}ag-=Z.y;aa+=Z.y;if(af){U=ag*af;V+=Z.X/2}if(ag<0){ab="s";ag=0}break;case"w":if(Z.x<=0&&(V<=0||af&&(aa<=0||Q>=ae))){S=J;break}U-=Z.x;V+=Z.x;if(af){ag=U/af;aa+=Z.Y/2}if(U<0){ab="e";U=0}break;case"s":if(Z.y>=0&&(Q>=ae||af&&(V<=0||ac>=ad))){S=J;break}ag+=Z.y;if(af){U=ag*af;V-=Z.X/2}if(ag<0){ab="n";ag=0}break;case"ne":if(af){if(Z.y<=0&&(aa<=0||ac>=ad)){S=J;break}ag-=Z.y;aa+=Z.y;U=ag*af}else{if(Z.x>=0){if(ac<ad){U+=Z.x}else{if(Z.y<=0&&aa<=0){S=J}}}else{U+=Z.x}if(Z.y<=0){if(aa>0){ag-=Z.y;aa+=Z.y}}else{ag-=Z.y;aa+=Z.y}}if(ag<0){ab="sw";ag=0;U=0}break;case"nw":if(af){if(Z.y<=0&&(aa<=0||V<=0)){S=J;break}ag-=Z.y;aa+=Z.y;U=ag*af;V+=Z.X}else{if(Z.x<=0){if(V>0){U-=Z.x;V+=Z.x}else{if(Z.y<=0&&aa<=0){S=J}}}else{U-=Z.x;V+=Z.x}if(Z.y<=0){if(aa>0){ag-=Z.y;aa+=Z.y}}else{ag-=Z.y;aa+=Z.y}}if(ag<0){ab="se";ag=0;U=0}break;case"sw":if(af){if(Z.x<=0&&(V<=0||Q>=ae)){S=J;break}U-=Z.x;V+=Z.x;ag=U/af}else{if(Z.x<=0){if(V>0){U-=Z.x;V+=Z.x}else{if(Z.y>=0&&Q>=ae){S=J}}}else{U-=Z.x;V+=Z.x}if(Z.y>=0){if(Q<ae){ag+=Z.y}}else{ag+=Z.y}}if(U<0){ab="ne";ag=0;U=0}break;case"se":if(af){if(Z.x>=0&&(ac>=ad||Q>=ae)){S=J;break}U+=Z.x;ag=U/af}else{if(Z.x>=0){if(ac<ad){U+=Z.x}else{if(Z.y>=0&&Q>=ae){S=J}}}else{U+=Z.x}if(Z.y>=0){if(Q<ae){ag+=Z.y}}else{ag+=Z.y}}if(U<0){ab="nw";ag=0;U=0}break;case"move":W.left+=Z.x;W.top+=Z.y;this.renderImage("move");S=J;break;case"zoom":if(X.zoomable){this.zoom(function(ah,am,aj,al,ai,ak){return(B(ai*ai+ak*ak)-B(aj*aj+al*al))/B(ah*ah+am*am)}(W.width,W.height,u(this.startX-this.startX2),u(this.startY-this.startY2),u(this.endX-this.endX2),u(this.endY-this.endY2)));this.endX2=this.startX2;this.endY2=this.startY2}break;case"crop":if(Z.x&&Z.y){Y=this.$cropper.offset();V=this.startX-Y.left;aa=this.startY-Y.top;U=T.minWidth;ag=T.minHeight;if(Z.x>0){if(Z.y>0){ab="se"}else{ab="ne";aa-=ag}}else{if(Z.y>0){ab="sw";V-=U}else{ab="nw";V-=U;aa-=ag}}if(!this.cropped){this.cropped=t;this.$dragger.removeClass(D)}}break}if(S){T.width=U;T.height=ag;T.left=V;T.top=aa;this.directive=ab;this.renderDragger()}this.startX=this.endX;this.startY=this.endY}};r.TEMPLATE=(function(Q,R){R=R.split(",");return Q.replace(/\d+/g,function(S){return R[S]})})('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed");r.DEFAULTS={aspectRatio:"auto",autoCropArea:0.8,data:{},done:z.noop,preview:"",multiple:J,autoCrop:t,dragCrop:t,dashed:t,modal:t,movable:t,resizable:t,zoomable:t,rotatable:t,minWidth:0,minHeight:0,maxWidth:j,maxHeight:j,build:v,built:v,dragstart:v,dragmove:v,dragend:v};r.setDefaults=function(Q){z.extend(r.DEFAULTS,Q)};r.other=z.fn.cropper;z.fn.cropper=function(S){var R=[].slice.call(arguments,1),Q;this.each(function(){var V=z(this),U=V.data("cropper"),T;if(!U){V.data("cropper",(U=new r(this,S)))}if(typeof S==="string"&&z.isFunction((T=U[S]))){Q=T.apply(U,R)}});return(typeof Q!==s?Q:this)};z.fn.cropper.Constructor=r;z.fn.cropper.setDefaults=r.setDefaults;z.fn.cropper.noConflict=function(){z.fn.cropper=r.other;return this}});