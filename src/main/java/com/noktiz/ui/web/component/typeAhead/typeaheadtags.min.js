!function(b){var a=function(d,c){this.$element=b(d);this.$typeaheadElement=this.$element.find(".typeahead");this.options=b.extend({},b.fn.typeaheadTags.defaults,c);this.$typeaheadElement.typeahead({source:this.options.source,items:this.options.items||8,matcher:this.options.matcher,sorter:this.options.sorter,highlighter:this.options.highlighter,updater:this.options.updater,item:this.options.item});this.monkeyPatch();if(this.options.renderTag){this.renderTag=this.options.renderTag}this.$tagCollection=this.options.$tagCollection||this.$element.find(".tag-collection");this.tags={};this.tagCount=0;this.listen()};a.prototype={constructor:a,listen:function(){this.$typeaheadElement.on("keydown",b.proxy(this.keydown,this)).on("typeaheadselect",b.proxy(this.change,this))},monkeyPatch:function(){var c=this.$typeaheadElement.data("typeahead");c.bootstrapSelect=c.select;c.select=function(){var f=this.$menu.find(".active").data("data-value");var d=b.Event("typeaheadselect",{val:f});this.$element.trigger(d);if(d.isDefaultPrevented()){return this.hide()}return this.bootstrapSelect()};if(this.options.render){c.render=this.options.render}},keydown:function(d){if(d.keyCode!=8){this.unhilight()}switch(d.keyCode){case 8:if(this.$typeaheadElement.val()==""){var c=b(".badge-warning");if(c.length==0){this.hilightPrevTag()}else{this.deletePrevTag()}}break;case 27:this.$typeaheadElement.val("");break;case 13:d.stopPropagation();d.preventDefault();break}},change:function(d){var c=this;this.tags[this.tagCount]=d.val;this.renderTag(d.val);this.tagCount++;d.preventDefault();setTimeout(function(){c.$typeaheadElement.val("");c.$typeaheadElement.focus()},0)},renderTag:function(h){var g=this,c=b('<li class="tagitem"></li>'),d=b('<button class="close">&times;</button>'),f=b('<span class="badge badge-info"></span>');c.attr("data-tag-id",id);c.data("data-value",h);f.text(h);f.prepend(d);c.append(f);this.$typeaheadElement.insertBefore(c);var e=this.tagCount;d.on("click",function(){g.deleteTag(e)})},hasTag:function(c){for(name in this.tags){if(this.tags.hasOwnProperty(name)&&this.tags[name]==c){return true}}return false},deletePrevTag:function(){var c=this.$tagCollection.children(".tagitem").last();if(!c){return}this.deleteTag(c.attr("data-tag-id"))},unhilight:function(){var c=b(".badge-warning");c.removeClass("badge-warning");c.addClass("badge-info")},hilightPrevTag:function(){var c=this.$tagCollection.children(".tagitem").last();if(!c){return}c.children("span").removeClass("badge-info");c.children("span").addClass("badge-warning")},deleteTag:function(c){var f=b(".tagitem[data-tag-id="+c+"]").data("data-value");var d=b.Event("typeaheaddelete",{val:f});this.$element.trigger(d);b(".tagitem[data-tag-id="+c+"]").remove();delete this.tags[c]}};b.fn.typeaheadTags=function(c){return this.each(function(){var f=b(this),e=f.data("typeaheadtags"),d=typeof c=="object"&&c;if(!e){f.data("typeaheadtags",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.typeaheadTags.defaults={};b.fn.typeaheadTags.Constructor=a;b(function(){b("body").on("focus.typeaheadtags.data-api",'[data-provide="typeaheadtags"]',function(d){var c=b(this);if(c.data("typeaheadtags")){return}d.preventDefault();c.typeaheadTags(c.data())})})}(window.jQuery);