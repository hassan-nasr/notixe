/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 3.1.0
 *
 * A simple yet powerful JQuery star rating plugin that allows rendering
 * fractional star ratings and supports Right to Left (RTL) input.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(e){var c=0;var i=5;var f=1;var h="ontouchstart" in window||(window.DocumentTouch&&document instanceof window.DocumentTouch);var d=function(l,k){return typeof l==="undefined"||l===null||l===undefined||l==[]||l===""||k&&e.trim(l)===""};var b=function(n,m,l){var k=d(n.data(m))?n.attr(m):n.data(m);if(k){return k}return l[m]};var a=function(l){var k=(""+l).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!k){return 0}return Math.max(0,(k[1]?k[1].length:0)-(k[2]?+k[2]:0))};var j=function(l,k){return parseFloat(l.toFixed(k))};var g=function(l,k){this.$element=e(l);this.init(k)};g.prototype={constructor:g,_parseAttr:function(o,n){var m=this,q=m.$element;if(q.attr("type")==="range"||q.attr("type")==="number"){var p=b(q,o,n);var l=f;if(o==="min"){l=c}else{if(o==="max"){l=i}else{if(o==="step"){l=f}}}var k=d(p)?l:p;return parseFloat(k)}return parseFloat(n[o])},listen:function(){var k=this;k.initTouch();k.$rating.on("click",function(m){if(k.inactive){return}var l=m.pageX-k.$rating.offset().left;k.setStars(l);k.$element.trigger("change");k.$element.trigger("rating.change",[k.$element.val(),k.$caption.html()]);k.starClicked=true});k.$rating.on("mousemove",function(m){if(!k.hoverEnabled||k.inactive){return}k.starClicked=false;var n=m.pageX-k.$rating.offset().left,l=k.calculate(n);k.toggleHover(l);k.$element.trigger("rating.hover",[l.val,l.caption,"stars"])});k.$rating.on("mouseleave",function(m){if(!k.hoverEnabled||k.inactive||k.starClicked){return}var l=k.cache;k.toggleHover(l);k.$element.trigger("rating.hoverleave",["stars"])});k.$clear.on("mousemove",function(o){if(!k.hoverEnabled||k.inactive||!k.hoverOnClear){return}k.clearClicked=false;var l='<span class="'+k.clearCaptionClass+'">'+k.clearCaption+"</span>",p=k.clearValue,n=k.getWidthFromValue(p),m;m={caption:l,width:n,val:p};k.toggleHover(m);k.$element.trigger("rating.hover",[p,l,"clear"])});k.$clear.on("mouseleave",function(m){if(!k.hoverEnabled||k.inactive||k.clearClicked||!k.hoverOnClear){return}var l=k.cache;k.toggleHover(l);k.$element.trigger("rating.hoverleave",["clear"])});k.$clear.on("click",function(l){if(!k.inactive){k.clear();k.clearClicked=true}});e(k.$element[0].form).on("reset",function(l){if(!k.inactive){k.reset()}})},setTouch:function(p,r){var m=this;if(!h||m.inactive){return}var q=p.originalEvent.touches[0].pageX-m.$rating.offset().left;if(r===true){m.setStars(q);m.$element.trigger("change");m.$element.trigger("rating.change",[m.$element.val(),m.$caption.html()]);m.starClicked=true}else{var n=m.calculate(q),l=n.val<=m.clearValue?m.fetchCaption(m.clearValue):n.caption,k=m.getWidthFromValue(m.clearValue),o=n.val<=m.clearValue?(m.rtl?(100-k)+"%":k+"%"):n.width;m.$caption.html(l);m.$stars.css("width",o)}},initTouch:function(){var k=this;k.$rating.on("touchstart",function(l){k.setTouch(l,false)});k.$rating.on("touchmove",function(l){k.setTouch(l,false)});k.$rating.on("touchend",function(l){k.setTouch(l,true)})},initSlider:function(l){var k=this;if(d(k.$element.val())){k.$element.val(0)}k.initialValue=k.$element.val();k.min=(typeof l.min!=="undefined")?l.min:k._parseAttr("min",l);k.max=(typeof l.max!=="undefined")?l.max:k._parseAttr("max",l);k.step=(typeof l.step!=="undefined")?l.step:k._parseAttr("step",l);if(isNaN(k.min)||d(k.min)){k.min=c}if(isNaN(k.max)||d(k.max)){k.max=i}if(isNaN(k.step)||d(k.step)||k.step==0){k.step=f}k.diff=k.max-k.min},init:function(m){var l=this;l.options=m;l.hoverEnabled=m.hoverEnabled;l.hoverChangeCaption=m.hoverChangeCaption;l.hoverChangeStars=m.hoverChangeStars;l.hoverOnClear=m.hoverOnClear;l.starClicked=false;l.clearClicked=false;l.initSlider(m);l.checkDisabled();$element=l.$element;l.containerClass=m.containerClass;l.glyphicon=m.glyphicon;var k=(l.glyphicon)?"\ue006":"\u2605";l.symbol=d(m.symbol)?k:m.symbol;l.rtl=m.rtl||l.$element.attr("dir");if(l.rtl){l.$element.attr("dir","rtl")}l.showClear=m.showClear;l.showCaption=m.showCaption;l.size=m.size;l.stars=m.stars;l.defaultCaption=m.defaultCaption;l.starCaptions=m.starCaptions;l.starCaptionClasses=m.starCaptionClasses;l.clearButton=m.clearButton;l.clearButtonTitle=m.clearButtonTitle;l.clearButtonBaseClass=!d(m.clearButtonBaseClass)?m.clearButtonBaseClass:"clear-rating";l.clearButtonActiveClass=!d(m.clearButtonActiveClass)?m.clearButtonActiveClass:"clear-rating-active";l.clearCaption=m.clearCaption;l.clearCaptionClass=m.clearCaptionClass;l.clearValue=d(m.clearValue)?l.min:m.clearValue;l.$element.removeClass("form-control").addClass("form-control");l.$clearElement=d(m.clearElement)?null:e(m.clearElement);l.$captionElement=d(m.captionElement)?null:e(m.captionElement);if(typeof l.$rating=="undefined"&&typeof l.$container=="undefined"){l.$rating=e(document.createElement("div")).html('<div class="rating-stars"></div>');l.$container=e(document.createElement("div"));l.$container.before(l.$rating);l.$container.append(l.$rating);l.$element.before(l.$container).appendTo(l.$rating)}l.$stars=l.$rating.find(".rating-stars");l.generateRating();l.$clear=!d(l.$clearElement)?l.$clearElement:l.$container.find("."+l.clearButtonBaseClass);l.$caption=!d(l.$captionElement)?l.$captionElement:l.$container.find(".caption");l.setStars();l.$element.hide();l.listen();if(l.showClear){l.$clear.attr({"class":l.getClearClass()})}l.cache={caption:l.$caption.html(),width:l.$stars.width(),val:l.$element.val()};l.$element.removeClass("rating-loading")},checkDisabled:function(){var k=this;k.disabled=b(k.$element,"disabled",k.options);k.readonly=b(k.$element,"readonly",k.options);k.inactive=(k.disabled||k.readonly)},getClearClass:function(){return this.clearButtonBaseClass+" "+((this.inactive)?"":this.clearButtonActiveClass)},generateRating:function(){var n=this,l=n.renderClear(),m=n.renderCaption(),o=(n.rtl)?"rating-container-rtl":"rating-container",k=n.getStars();o+=(n.glyphicon)?((n.symbol=="\ue006")?" rating-gly-star":" rating-gly"):" rating-uni";n.$rating.attr("class",o);n.$rating.attr("data-content",k);n.$stars.attr("data-content",k);var o=n.rtl?"star-rating-rtl":"star-rating";n.$container.attr("class",o+" rating-"+n.size);if(n.inactive){n.$container.removeClass("rating-active").addClass("rating-disabled")}else{n.$container.removeClass("rating-disabled").addClass("rating-active")}if(typeof n.$caption=="undefined"&&typeof n.$clear=="undefined"){if(n.rtl){n.$container.prepend(m).append(l)}else{n.$container.prepend(l).append(m)}}if(!d(n.containerClass)){n.$container.removeClass(n.containerClass).addClass(n.containerClass)}},getStars:function(){var m=this,l=m.stars,k="";for(var n=1;n<=l;n++){k+=m.symbol}return k},renderClear:function(){var k=this;if(!k.showClear){return""}var l=k.getClearClass();if(!d(k.$clearElement)){k.$clearElement.removeClass(l).addClass(l).attr({title:k.clearButtonTitle});k.$clearElement.html(k.clearButton);return""}return'<div class="'+l+'" title="'+k.clearButtonTitle+'">'+k.clearButton+"</div>"},renderCaption:function(){var k=this,m=k.$element.val();if(!k.showCaption){return""}var l=k.fetchCaption(m);if(!d(k.$captionElement)){k.$captionElement.removeClass("caption").addClass("caption").attr({title:k.clearCaption});k.$captionElement.html(l);return""}return'<div class="caption">'+l+"</div>"},fetchCaption:function(o){var l=this;var p=parseFloat(o),n,m;if(typeof(l.starCaptionClasses)=="function"){n=d(l.starCaptionClasses(p))?l.clearCaptionClass:l.starCaptionClasses(p)}else{n=d(l.starCaptionClasses[p])?l.clearCaptionClass:l.starCaptionClasses[p]}if(typeof(l.starCaptions)=="function"){var m=d(l.starCaptions(p))?l.defaultCaption.replace(/\{rating\}/g,p):l.starCaptions(p)}else{var m=d(l.starCaptions[p])?l.defaultCaption.replace(/\{rating\}/g,p):l.starCaptions[p]}var k=(p==l.clearValue)?l.clearCaption:m;return'<span class="'+n+'">'+k+"</span>"},getWidthFromValue:function(o){var l=this,m=l.min,k=l.max,n=l.step;if(o<=m||m==k){return 0}if(o>=k){return 100}return(o-m)*100/(k-m)},getValueFromPosition:function(p){var m=this,l=a(m.step),k,o,n=m.$rating.width();k=(p/n);if(m.rtl){o=(m.min+Math.floor(m.diff*k/m.step)*m.step)}else{o=(m.min+Math.ceil(m.diff*k/m.step)*m.step)}if(o<m.min){o=m.min}else{if(o>m.max){o=m.max}}o=j(parseFloat(o),l);if(m.rtl){o=m.max-o}return o},toggleHover:function(n){var m=this;if(m.hoverChangeCaption){var l=n.val<=m.clearValue?m.fetchCaption(m.clearValue):n.caption;m.$caption.html(l)}if(m.hoverChangeStars){var k=m.getWidthFromValue(m.clearValue),o=n.val<=m.clearValue?(m.rtl?(100-k)+"%":k+"%"):n.width;m.$stars.css("width",o)}},calculate:function(p){var l=this,o=d(l.$element.val())?0:l.$element.val(),n=arguments.length?l.getValueFromPosition(p):o,k=l.fetchCaption(n),m=l.getWidthFromValue(n);if(l.rtl){m=100-m}m+="%";return{caption:k,width:m,val:n}},setStars:function(m){var k=this,l=arguments.length?k.calculate(m):k.calculate();k.$element.val(l.val);k.$stars.css("width",l.width);k.$caption.html(l.caption);k.cache=l},clear:function(){var k=this;var l='<span class="'+k.clearCaptionClass+'">'+k.clearCaption+"</span>";k.$stars.removeClass("rated");if(!k.inactive){k.$caption.html(l)}k.$element.val(k.clearValue);k.setStars();k.$element.trigger("rating.clear")},reset:function(){var k=this;k.$element.val(k.initialValue);k.setStars();k.$element.trigger("rating.reset")},update:function(l){if(arguments.length>0){var k=this;k.$element.val(l);k.setStars()}},refresh:function(l){var k=this;if(arguments.length){k.$rating.off();k.$clear.off();k.init(e.extend(k.options,l));if(k.showClear){k.$clear.show()}else{k.$clear.hide()}if(k.showCaption){k.$caption.show()}else{k.$caption.hide()}k.$element.trigger("rating.refresh")}}};e.fn.rating=function(l){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var o=e(this),n=o.data("rating"),m=typeof l==="object"&&l;if(!n){o.data("rating",(n=new g(this,e.extend({},e.fn.rating.defaults,m,e(this).data()))))}if(typeof l==="string"){n[l].apply(n,k)}})};e.fn.rating.defaults={stars:5,glyphicon:true,symbol:null,disabled:false,readonly:false,rtl:false,size:"md",showClear:true,showCaption:true,defaultCaption:"{rating} Stars",starCaptions:{0.5:"Half Star",1:"One Star",1.5:"One & Half Star",2:"Two Stars",2.5:"Two & Half Stars",3:"Three Stars",3.5:"Three & Half Stars",4:"Four Stars",4.5:"Four & Half Stars",5:"Five Stars"},starCaptionClasses:{0.5:"label label-danger",1:"label label-danger",1.5:"label label-warning",2:"label label-warning",2.5:"label label-info",3:"label label-info",3.5:"label label-primary",4:"label label-primary",4.5:"label label-success",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"></i>',clearButtonTitle:"Clear",clearButtonBaseClass:"clear-rating",clearButtonActiveClass:"clear-rating-active",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:null,captionElement:null,clearElement:null,containerClass:null,hoverEnabled:true,hoverChangeCaption:true,hoverChangeStars:true,hoverOnClear:true};e("input.rating").addClass("rating-loading");e(document).ready(function(){var l=e("input.rating"),k=Object.keys(l).length;if(k>0){l.rating()}})}(jQuery));